var documenterSearchIndex = {"docs":
[{"location":"amortized_bayesian_inference/#Introduction","page":"Amortized Bayesian Inference","title":"Introduction","text":"","category":"section"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"This page demonstrates how to perform amortized Bayesian inference using neural networks. Click below to reveal a full copy-and-pastable version of the code.","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"<details>\n<summary><b>Show Full Code</b></summary>","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"using ACTRPVT\nusing AlgebraOfGraphics\nusing CairoMakie\nusing Distributions\nusing Flux\nusing NeuralEstimators\nusing Plots\n\nn = 1           # dimension of each data replicate \nm = 50          # number of independent replicates \nd = 4           # dimension of the parameter vector θ\nw = 128         # width of each hidden layer \n\nfunction sample(K)\n    υτ = rand(MvNormal([5, 4], [4 2; 2 4]), K)\n    λ = rand(Beta(98, 2), K)\n    γ = rand(truncated(Normal(.04, .01),0, Inf), K)\n    θ = vcat(υτ, λ' , γ')\n    return θ\nend\nto_matrix(x) = reshape(x, 1, length(x))\nsimulate(θ, m) = [to_matrix(rand(PVTModel(ϑ...), m)) for ϑ ∈ eachcol(θ)] \n\n# Approximate distribution\napprox_dist = NormalisingFlow(d, 2d)\n\n# Neural network mapping data to summary statistics (of the same dimension used in the approximate distribution)\nψ = Chain(x -> sign.(x) .* log.(1 .+ abs.(x)), Dense(n, w, relu), Dense(w, w, relu)) # NB now using log-transform for numerical stability\nϕ = Chain(Dense(w, w, relu), Dense(w, 2d))           \nnetwork = DeepSet(ψ, ϕ)\n\n# Initialise a neural posterior estimator\nestimator = PosteriorEstimator(approx_dist, network) \n\n# Train the estimator\ntrained_estimator = train(\n    estimator, \n    sample, \n    simulate; \n    m, \n    epochs = 20,\n    K = 10_000\n)\n\n# Assess the estimator\nθ_test = sample(1000)\nZ_test = simulate(θ_test, m)\nassessment = assess(trained_estimator, θ_test, Z_test)\nbias(assessment)  \nrmse(assessment) \nAlgebraOfGraphics.plot(assessment)\n\n# Apply the estimator to observed data\nθ = [5,3,.99,.041]       # true parameters\nZ = simulate(θ, m)       # \"observed\" data\npost_samples = sampleposterior(trained_estimator, Z)\nPlots.histogram(post_samples', layout = (4,1), norm = true, leg = false, title = [\"υ\" \"τ\" \"λ\" \"γ\"])\nvline!([θ'], color = :red)\n\n# Apply the estimator to observed data\nθ = [2,3,.96,.031]       # true parameters\nZ = simulate(θ, m)       # \"observed\" data\npost_samples = sampleposterior(trained_estimator, Z)\nPlots.histogram(post_samples', layout = (4,1), norm = true, leg = false, title = [\"υ\" \"τ\" \"λ\" \"γ\"])\nvline!([θ'], color = :red)","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"</details>","category":"page"},{"location":"amortized_bayesian_inference/#Load-the-Dependencies","page":"Amortized Bayesian Inference","title":"Load the Dependencies","text":"","category":"section"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"using ACTRPVT\nusing AlgebraOfGraphics\nusing CairoMakie\nusing Distributions\nusing Flux\nusing NeuralEstimators\nusing Plots","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"n = 1           # dimension of each data replicate \nm = 50          # number of independent replicates \nd = 4           # dimension of the parameter vector θ\nw = 128         # width of each hidden layer ","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"function sample(K)\n    υτ = rand(MvNormal([5, 4], [4 2; 2 4]), K)\n    λ = rand(Beta(98, 2), K)\n    γ = rand(truncated(Normal(.04, .01),0, Inf), K)\n    θ = vcat(υτ, λ' , γ')\n    return θ\nend","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"to_matrix(x) = reshape(x, 1, length(x))\nsimulate(θ, m) = [to_matrix(rand(PVTModel(ϑ...), m)) for ϑ ∈ eachcol(θ)] ","category":"page"},{"location":"amortized_bayesian_inference/#Configure-the-Neural-Network","page":"Amortized Bayesian Inference","title":"Configure the Neural Network","text":"","category":"section"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"approx_dist = NormalisingFlow(d, 2d)\n\nψ = Chain(x -> sign.(x) .* log.(1 .+ abs.(x)), Dense(n, w, relu), Dense(w, w, relu))\nϕ = Chain(Dense(w, w, relu), Dense(w, 2d))           \nnetwork = DeepSet(ψ, ϕ)","category":"page"},{"location":"amortized_bayesian_inference/#create-the-estimator","page":"Amortized Bayesian Inference","title":"create the estimator","text":"","category":"section"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"estimator = PosteriorEstimator(approx_dist, network) ","category":"page"},{"location":"amortized_bayesian_inference/#Train-the-estimator","page":"Amortized Bayesian Inference","title":"Train the estimator","text":"","category":"section"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"trained_estimator = train(\n    estimator, \n    sample, \n    simulate; \n    m, \n    epochs = 20,\n    K = 10_000\n)","category":"page"},{"location":"amortized_bayesian_inference/#Assess-the-estimator","page":"Amortized Bayesian Inference","title":"Assess the estimator","text":"","category":"section"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"θ_test = sample(1000)\nZ_test = simulate(θ_test, m)\nassessment = assess(trained_estimator, θ_test, Z_test)\nbias(assessment)  \nrmse(assessment) \nAlgebraOfGraphics.plot(assessment)","category":"page"},{"location":"amortized_bayesian_inference/#Estimate-the-Posterior-Distributions","page":"Amortized Bayesian Inference","title":"Estimate the Posterior Distributions","text":"","category":"section"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"The examples below estimate the posterior distributions using data generated from two different sets of parameters. The vertical red lines in each sub-plot indicate the ground truth parameter values. ","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"θ = [5,3,.99,.041]       # true parameters\nZ = simulate(θ, m)       # \"observed\" data\npost_samples = sampleposterior(trained_estimator, Z)\nPlots.histogram(post_samples', layout = (4,1), norm = true, leg = false, title = [\"υ\" \"τ\" \"λ\" \"γ\"])\nvline!([θ'], color = :red)","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"(Image: )","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"θ = [2,3,.96,.031]       # true parameters\nZ = simulate(θ, m)       # \"observed\" data\npost_samples = sampleposterior(trained_estimator, Z)\nPlots.histogram(post_samples', layout = (4,1), norm = true, leg = false, title = [\"υ\" \"τ\" \"λ\" \"γ\"])\nvline!([θ'], color = :red)","category":"page"},{"location":"amortized_bayesian_inference/","page":"Amortized Bayesian Inference","title":"Amortized Bayesian Inference","text":"(Image: )","category":"page"},{"location":"#ACTRPVT.jl","page":"Home","title":"ACTRPVT.jl","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Documentation for ACTRPVT.jl","category":"page"}]
}
